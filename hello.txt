import java.io.*;
import java.net.*;
import java.nio.file.*;

public class hs {
    public static void main(String[] args) throws IOException {
        ServerSocket serverSocket = new ServerSocket(8080);
        System.out.println("Server started on port 8080...");

        while (true) {
            Socket client = serverSocket.accept();
            new Thread(() -> handleClient(client)).start();
        }
    }

    private static void handleClient(Socket client) {
        try (BufferedReader in = new BufferedReader(new InputStreamReader(client.getInputStream()));
             OutputStream out = client.getOutputStream()) {

            String requestLine = in.readLine();
            if (requestLine == null) return;

            System.out.println("Request: " + requestLine);

            String[] parts = requestLine.split(" ");
            String method = parts[0];
            String path = parts[1];

            if (method.equals("POST") && path.equals("/upload")) {
                handleUpload(in, client.getInputStream(), out);
            } else if (method.equals("GET") && path.startsWith("/download/")) {
                String fileName = path.substring("/download/".length());
                handleDownload(fileName, out);
            } else {
                out.write("HTTP/1.1 404 Not Found\r\n\r\nUnknown request.".getBytes());
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private static void handleUpload(BufferedReader in, InputStream inputStream, OutputStream out) throws IOException {
        int contentLength = 0;
        String line;
        while (!(line = in.readLine()).isEmpty()) {
            if (line.startsWith("Content-Length:")) {
                contentLength = Integer.parseInt(line.split(":")[1].trim());
            }
        }

        byte[] data = inputStream.readNBytes(contentLength);
        String fileName = "uploaded_file_" + System.currentTimeMillis();
        Files.write(Paths.get(fileName), data);

        String responseBody = "Upload successful: saved as " + fileName;
        out.write(("HTTP/1.1 200 OK\r\nContent-Length: " + responseBody.length() + "\r\n\r\n" + responseBody).getBytes());
    }

    private static void handleDownload(String fileName, OutputStream out) throws IOException {
        File file = new File(fileName);
        if (!file.exists()) {
            String responseBody = "File not found: " + fileName;
            out.write(("HTTP/1.1 404 Not Found\r\nContent-Length: " + responseBody.length() + "\r\n\r\n" + responseBody).getBytes());
            return;
        }

        byte[] fileBytes = Files.readAllBytes(file.toPath());
        out.write(("HTTP/1.1 200 OK\r\nContent-Length: " + fileBytes.length + "\r\n\r\n").getBytes());
        out.write(fileBytes);
    }
}


import java.io.*;
import java.net.*;

public class hc {
    public static void main(String[] args) throws Exception {
        if (args.length < 2) {
            System.out.println("Usage:");
            System.out.println("  java SimpleHttpClient upload <filePath>");
            System.out.println("  java SimpleHttpClient download <fileName>");
            return;
        }

        String command = args[0];
        if (command.equalsIgnoreCase("upload")) {
            uploadFile(args[1]);
        } else if (command.equalsIgnoreCase("download")) {
            downloadFile(args[1]);
        } else {
            System.out.println("Unknown command.");
        }
    }

    private static void uploadFile(String filePath) throws Exception {
        File file = new File(filePath);
        if (!file.exists()) {
            System.out.println(" File not found: " + filePath);
            return;
        }

        byte[] data = new byte[(int) file.length()];
        try (FileInputStream fis = new FileInputStream(file)) {
            fis.read(data);
        }

        Socket socket = new Socket("localhost", 8080);
        OutputStream out = socket.getOutputStream();
        out.write(("POST / HTTP/1.1\r\nHost: localhost\r\nContent-Length: " + data.length + "\r\n\r\n").getBytes());
        out.write(data);
        out.flush();

        BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
        String line;
        boolean bodyStarted = false;
        System.out.println("----- Server Response -----");
        while ((line = in.readLine()) != null) {
            if (line.isEmpty()) {
                bodyStarted = true;
                continue;
            }
            if (bodyStarted) System.out.println(line);
        }

        socket.close();
    }

    private static void downloadFile(String fileName) throws Exception {
        Socket socket = new Socket("localhost", 8080);
        OutputStream out = socket.getOutputStream();
        out.write(("GET /" + fileName + " HTTP/1.1\r\nHost: localhost\r\n\r\n").getBytes());
        out.flush();

        InputStream in = socket.getInputStream();
        BufferedReader reader = new BufferedReader(new InputStreamReader(in));

        String line;
        boolean headerEnded = false;
        while ((line = reader.readLine()) != null) {
            if (line.isEmpty()) {
                headerEnded = true;
                break;
            }
        }

        if (headerEnded) {
            byte[] bytes = in.readAllBytes();
            try (FileOutputStream fos = new FileOutputStream("downloaded_" + fileName)) {
                fos.write(bytes);
            }
            System.out.println(" File downloaded: downloaded_" + fileName);
        }

        socket.close();
    }
}
